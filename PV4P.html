<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TERRA: OMEGA INTERFACE</title>
  <style>
    :root {
      --bg-dark: #050505;
      --bg-panel: #0f111a;
      --primary: #3b82f6; /* Electric Blue */
      --accent: #10b981;  /* Neon Green */
      --warning: #f59e0b; /* Amber */
      --danger: #ef4444;  /* Red */
      --text-main: #e2e8f0;
      --text-muted: #94a3b8;
      --border: #1e293b;
      --glass: rgba(15, 17, 26, 0.7);
    }

    * { box-sizing: border-box; scrollbar-width: thin; scrollbar-color: var(--primary) var(--bg-dark); }

    body {
      background-color: var(--bg-dark);
      color: var(--text-main);
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* === HEADER === */
    header {
      background: var(--bg-panel);
      border-bottom: 1px solid var(--border);
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }

    .brand {
      font-size: 24px;
      font-weight: 900;
      letter-spacing: 3px;
      color: var(--text-main);
      text-transform: uppercase;
    }
    .brand span { color: var(--primary); }

    .top-controls {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    /* Toggle Switch */
    .mode-switch {
      display: flex;
      background: #000;
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 3px;
      position: relative;
    }

    .mode-btn {
      background: transparent;
      border: none;
      color: var(--text-muted);
      padding: 8px 16px;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      text-transform: uppercase;
      border-radius: 18px;
      transition: 0.3s;
      z-index: 2;
    }

    .mode-btn.active {
      color: #000;
      background: var(--primary);
      box-shadow: 0 0 10px var(--primary);
    }

    /* Search & Reset */
    #search-input {
      background: #000;
      border: 1px solid var(--border);
      color: var(--primary);
      padding: 10px 15px;
      border-radius: 6px;
      outline: none;
      width: 200px;
      transition: width 0.3s, border-color 0.3s;
    }
    #search-input:focus { width: 260px; border-color: var(--primary); }

    .reset-btn {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--danger);
      color: var(--danger);
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }
    .reset-btn:hover { background: var(--danger); color: #fff; }

    /* === LAYOUT === */
    .main-container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* === SIDEBAR FILTERS === */
    .sidebar {
      width: 360px;
      background: var(--bg-panel);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 15px;
      font-size: 12px;
      text-transform: uppercase;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border);
      letter-spacing: 1px;
    }

    /* Accordion */
    .accordion {
      border-bottom: 1px solid var(--border);
    }
    
    .accordion-header {
      padding: 12px 15px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.02);
      transition: 0.2s;
    }
    .accordion-header:hover { background: rgba(255,255,255,0.05); }
    .accordion-header span { font-size: 13px; font-weight: 600; color: var(--text-main); }
    .icon { transition: transform 0.3s; font-size: 10px; }
    .accordion.open .icon { transform: rotate(180deg); }
    
    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      background: #080a10;
    }
    .accordion.open .accordion-content { max-height: 500px; overflow-y: auto; }

    .tag-container {
      padding: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .filter-tag {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 6px 10px;
      font-size: 11px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      flex-grow: 1;
      text-align: center;
    }

    .filter-tag:hover { border-color: var(--primary); color: var(--primary); }
    .filter-tag.active {
      background: rgba(59, 130, 246, 0.2);
      border-color: var(--primary);
      color: var(--primary);
      box-shadow: 0 0 8px rgba(59, 130, 246, 0.3);
    }

    /* === RESULTS GRID === */
    .results-wrapper {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: radial-gradient(circle at top right, #151926 0%, #050505 100%);
      position: relative;
    }

    .stats-bar {
      margin-bottom: 20px;
      font-size: 14px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
    }
    #result-count { color: var(--accent); font-weight: bold; }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      padding-bottom: 50px;
    }

    .card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(5px);
    }

    .card::before {
      content: "";
      position: absolute;
      top: 0; left: 0; width: 4px; height: 100%;
      background: var(--border);
      transition: 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      background: rgba(255,255,255,0.06);
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }
    
    .card:hover::before { background: var(--primary); }

    .card-title { font-size: 16px; font-weight: bold; color: #fff; }
    .card-sub { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
    
    .card-badge {
      position: absolute;
      top: 10px; right: 10px;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      background: #000;
      border: 1px solid var(--border);
    }

    /* Responsive */
    @media (max-width: 900px) {
      .main-container { flex-direction: column; }
      .sidebar { width: 100%; height: 300px; border-right: none; border-bottom: 1px solid var(--border); }
      header { flex-direction: column; gap: 10px; }
      .top-controls { width: 100%; justify-content: space-between; }
    }
  </style>
</head>
<body>

  <header>
    <div class="brand">TERRA <span>OMEGA</span></div>
    
    <div class="top-controls">
      <!-- MODE SWITCHER -->
      <div class="mode-switch">
        <button class="mode-btn active" id="mode-country">Global (195)</button>
        <button class="mode-btn" id="mode-state">Subdivisions</button>
      </div>

      <input type="text" id="search-input" placeholder="Search Database...">
      <button class="reset-btn" id="reset">RESET</button>
    </div>
  </header>

  <div class="main-container">
    <!-- FILTERS -->
    <aside class="sidebar" id="filter-container">
      <div class="sidebar-header">Database Filters</div>
      <!-- Injected via JS -->
    </aside>

    <!-- RESULTS -->
    <main class="results-wrapper">
      <div class="stats-bar">
        <span>Active Database: <span id="db-name">Countries</span></span>
        <span id="result-count">0 Entities Found</span>
      </div>
      <div class="grid" id="grid"></div>
    </main>
  </div>

<script>
// ==========================================
// 1. CATEGORY CONFIGURATION
// ==========================================
const categories = [
  { 
    id: "geo", name: "Geography", 
    tags: [
      {id:"geo_mtn", l:"Mountain"}, {id:"geo_fst", l:"Forest"}, {id:"geo_des", l:"Desert"},
      {id:"geo_bch", l:"Beach"}, {id:"geo_isl", l:"Island"}, {id:"geo_riv", l:"River"},
      {id:"geo_lnd", l:"Landlocked"}, {id:"geo_cst", l:"Coastal"}
    ]
  },
  {
    id: "clim", name: "Climate & Weather",
    tags: [
      {id:"cl_cold", l:"Cold Winter"}, {id:"cl_hot", l:"Hot/Arid"}, {id:"cl_trop", l:"Tropical"},
      {id:"cl_snow", l:"Snowy"}, {id:"cl_rain", l:"Rainy"}, {id:"cl_dry", l:"Dry"}
    ]
  },
  {
    id: "reg", name: "Region / Parent",
    tags: [
      {id:"reg_eu", l:"Europe"}, {id:"reg_as", l:"Asia"}, {id:"reg_af", l:"Africa"},
      {id:"reg_na", l:"N. America"}, {id:"reg_sa", l:"S. America"}, {id:"reg_oc", l:"Oceania"},
      // Special tags for Subdivision Mode linking
      {id:"p_usa", l:"USA State"}, {id:"p_can", l:"Canada Prov"}, {id:"p_aus", l:"Aus State"}, {id:"p_uk", l:"UK Nation"}
    ]
  },
  {
    id: "soc", name: "Society & Safety",
    tags: [
      {id:"soc_safe", l:"Very Safe"}, {id:"soc_warn", l:"Caution"}, 
      {id:"soc_rich", l:"High Income"}, {id:"soc_dev", l:"Developing"},
      {id:"soc_lib", l:"Liberal"}, {id:"soc_con", l:"Conservative"}
    ]
  },
  {
    id: "tech", name: "Tech & Infra",
    tags: [
      {id:"inf_good", l:"Good Internet"}, {id:"inf_bad", l:"Poor Internet"},
      {id:"dr_r", l:"Drive Right"}, {id:"dr_l", l:"Drive Left"},
      {id:"v_110", l:"110V Power"}, {id:"v_220", l:"220V Power"}
    ]
  },
  {
    id: "cult", name: "Culture & Food",
    tags: [
      {id:"food_spi", l:"Spicy Food"}, {id:"food_bld", l:"Mild Food"},
      {id:"rel_chr", l:"Christian"}, {id:"rel_isl", l:"Muslim"}, {id:"rel_bud", l:"Buddhist"},
      {id:"lang_en", l:"English"}, {id:"lang_sp", l:"Spanish"}, {id:"lang_fr", l:"French"}
    ]
  },
  {
    id: "pol", name: "Politics & Visa",
    tags: [
      {id:"pol_eu", l:"EU Member"}, {id:"pol_nato", l:"NATO"}, {id:"pol_visa_easy", l:"Easy Visa"},
      {id:"gov_rep", l:"Republic"}, {id:"gov_mon", l:"Monarchy"}
    ]
  },
  {
    id: "misc", name: "Miscellaneous",
    tags: [
      {id:"misc_bear", l:"Has Bears"}, {id:"misc_pop_hi", l:"High Pop"}, {id:"misc_pop_lo", l:"Low Pop"},
      {id:"misc_hist", l:"Historic Ruins"}
    ]
  }
];

// ==========================================
// 2. DATABASE (Dual Layer)
// ==========================================

// COUNTRIES (195 entities - abbreviated for script length, full logic applied)
// Format: Name, Tags
const dbCountries = [
  {n:"Afghanistan", t:["reg_as","geo_mtn","geo_des","geo_lnd","cl_hot","soc_warn","soc_dev","rel_isl","misc_bear"]},
  {n:"Albania", t:["reg_eu","geo_mtn","geo_cst","cl_cold","pol_nato","soc_dev","rel_isl","misc_bear"]},
  {n:"Algeria", t:["reg_af","geo_des","geo_cst","cl_hot","soc_dev","rel_isl","lang_fr","misc_pop_hi"]},
  {n:"Andorra", t:["reg_eu","geo_mtn","geo_lnd","cl_snow","soc_safe","soc_rich","gov_mon","lang_sp","lang_fr"]},
  {n:"Angola", t:["reg_af","geo_fst","geo_cst","cl_trop","soc_dev","rel_chr"]},
  {n:"Antigua & Barbuda", t:["reg_na","geo_isl","geo_bch","cl_trop","soc_dev","lang_en","gov_mon"]},
  {n:"Argentina", t:["reg_sa","geo_mtn","geo_cst","geo_des","cl_cold","soc_dev","lang_sp","food_bld"]},
  {n:"Armenia", t:["reg_as","geo_mtn","geo_lnd","cl_cold","rel_chr","soc_dev","misc_bear"]},
  {n:"Australia", t:["reg_oc","geo_isl","geo_des","geo_bch","cl_hot","soc_safe","soc_rich","dr_l","lang_en","gov_mon"]},
  {n:"Austria", t:["reg_eu","geo_mtn","geo_fst","geo_lnd","cl_snow","soc_safe","soc_rich","pol_eu","misc_bear"]},
  {n:"Azerbaijan", t:["reg_as","geo_mtn","geo_cst","cl_cold","soc_dev","rel_isl","misc_bear"]},
  {n:"Bahamas", t:["reg_na","geo_isl","geo_bch","cl_trop","soc_rich","dr_l","gov_mon","lang_en"]},
  {n:"Bahrain", t:["reg_as","geo_isl","geo_des","cl_hot","soc_rich","rel_isl"]},
  {n:"Bangladesh", t:["reg_as","geo_fst","geo_cst","cl_trop","soc_dev","rel_isl","misc_pop_hi","misc_bear"]},
  {n:"Barbados", t:["reg_na","geo_isl","geo_bch","cl_trop","soc_dev","dr_l","lang_en"]},
  {n:"Belarus", t:["reg_eu","geo_fst","geo_lnd","cl_snow","soc_dev","rel_chr","misc_bear"]},
  {n:"Belgium", t:["reg_eu","geo_fst","geo_cst","cl_rain","soc_safe","soc_rich","pol_eu","pol_nato","gov_mon","lang_fr"]},
  {n:"Belize", t:["reg_na","geo_fst","geo_bch","cl_trop","soc_dev","lang_en","lang_sp"]},
  {n:"Benin", t:["reg_af","geo_fst","geo_cst","cl_trop","soc_dev","lang_fr"]},
  {n:"Bhutan", t:["reg_as","geo_mtn","geo_lnd","cl_snow","soc_dev","rel_bud","misc_bear"]},
  {n:"Bolivia", t:["reg_sa","geo_mtn","geo_lnd","cl_cold","soc_dev","lang_sp","misc_bear"]},
  {n:"Bosnia", t:["reg_eu","geo_mtn","geo_cst","cl_cold","soc_dev","rel_isl","misc_bear"]},
  {n:"Botswana", t:["reg_af","geo_des","geo_lnd","cl_hot","soc_safe","soc_dev","dr_l","lang_en"]},
  {n:"Brazil", t:["reg_sa","geo_fst","geo_bch","cl_trop","soc_dev","rel_chr","misc_pop_hi"]},
  {n:"Brunei", t:["reg_as","geo_fst","geo_cst","cl_trop","soc_rich","dr_l","rel_isl","misc_bear"]},
  {n:"Bulgaria", t:["reg_eu","geo_mtn","geo_cst","cl_snow","soc_dev","pol_eu","pol_nato","misc_bear"]},
  {n:"Burkina Faso", t:["reg_af","geo_des","geo_lnd","cl_hot","soc_warn","soc_dev","lang_fr"]},
  {n:"Burundi", t:["reg_af","geo_mtn","geo_lnd","cl_trop","soc_warn","soc_dev","lang_fr"]},
  {n:"Cambodia", t:["reg_as","geo_fst","geo_cst","cl_trop","soc_dev","rel_bud","misc_bear"]},
  {n:"Cameroon", t:["reg_af","geo_mtn","geo_fst","cl_trop","soc_dev","lang_fr","lang_en"]},
  {n:"Canada", t:["reg_na","geo_mtn","geo_fst","geo_cst","cl_snow","soc_safe","soc_rich","pol_nato","gov_mon","lang_en","lang_fr","misc_bear","v_110"]},
  {n:"Chad", t:["reg_af","geo_des","geo_lnd","cl_hot","soc_warn","soc_dev","lang_fr"]},
  {n:"Chile", t:["reg_sa","geo_mtn","geo_des","geo_cst","cl_cold","soc_safe","soc_dev","lang_sp"]},
  {n:"China", t:["reg_as","geo_mtn","geo_des","geo_cst","cl_snow","soc_rich","soc_con","misc_pop_hi","misc_bear"]},
  {n:"Colombia", t:["reg_sa","geo_mtn","geo_fst","geo_cst","cl_trop","soc_dev","lang_sp","misc_bear"]},
  {n:"Costa Rica", t:["reg_na","geo_fst","geo_bch","cl_trop","soc_safe","soc_dev","lang_sp"]},
  {n:"Croatia", t:["reg_eu","geo_bch","geo_cst","cl_cold","soc_safe","pol_eu","misc_bear"]},
  {n:"Cuba", t:["reg_na","geo_isl","geo_bch","cl_trop","soc_dev","soc_con","lang_sp"]},
  {n:"Cyprus", t:["reg_eu","geo_isl","geo_bch","cl_hot","soc_safe","pol_eu","dr_l"]},
  {n:"Czechia", t:["reg_eu","geo_fst","geo_mtn","geo_lnd","cl_snow","soc_safe","pol_eu","pol_nato"]},
  {n:"Denmark", t:["reg_eu","geo_bch","geo_cst","cl_rain","soc_safe","soc_rich","pol_eu","gov_mon"]},
  {n:"Egypt", t:["reg_af","geo_des","geo_cst","cl_hot","soc_dev","rel_isl","misc_pop_hi","misc_hist"]},
  {n:"Estonia", t:["reg_eu","geo_fst","geo_cst","cl_snow","soc_safe","pol_eu","inf_good","misc_bear"]},
  {n:"Ethiopia", t:["reg_af","geo_mtn","geo_lnd","cl_hot","soc_dev","rel_chr","misc_pop_hi"]},
  {n:"Fiji", t:["reg_oc","geo_isl","geo_bch","cl_trop","soc_dev","dr_l","lang_en"]},
  {n:"Finland", t:["reg_eu","geo_fst","geo_cst","cl_snow","soc_safe","soc_rich","pol_eu","misc_bear"]},
  {n:"France", t:["reg_eu","geo_mtn","geo_bch","cl_cold","soc_safe","soc_rich","pol_eu","lang_fr","misc_bear","food_bld"]},
  {n:"Germany", t:["reg_eu","geo_fst","geo_mtn","geo_cst","cl_cold","soc_safe","soc_rich","pol_eu","misc_pop_hi","misc_bear"]},
  {n:"Greece", t:["reg_eu","geo_bch","geo_isl","cl_hot","soc_safe","pol_eu","misc_hist","misc_bear"]},
  {n:"Hungary", t:["reg_eu","geo_lnd","cl_cold","soc_safe","pol_eu","soc_con"]},
  {n:"Iceland", t:["reg_eu","geo_isl","geo_mtn","cl_snow","soc_safe","soc_rich","inf_good"]},
  {n:"India", t:["reg_as","geo_mtn","geo_des","geo_cst","cl_trop","soc_dev","rel_chr","rel_isl","lang_en","food_spi","misc_pop_hi","misc_bear"]},
  {n:"Indonesia", t:["reg_as","geo_isl","geo_fst","cl_trop","soc_dev","rel_isl","food_spi","misc_pop_hi","misc_bear"]},
  {n:"Iran", t:["reg_as","geo_mtn","geo_des","cl_hot","soc_warn","rel_isl","misc_bear"]},
  {n:"Iraq", t:["reg_as","geo_des","cl_hot","soc_warn","rel_isl","misc_bear"]},
  {n:"Ireland", t:["reg_eu","geo_isl","geo_cst","cl_rain","soc_safe","soc_rich","pol_eu","dr_l","lang_en"]},
  {n:"Israel", t:["reg_as","geo_des","geo_cst","cl_hot","soc_safe","soc_rich","inf_good"]},
  {n:"Italy", t:["reg_eu","geo_mtn","geo_bch","cl_hot","soc_safe","soc_rich","pol_eu","food_bld","misc_hist","misc_bear"]},
  {n:"Jamaica", t:["reg_na","geo_isl","geo_bch","cl_trop","soc_dev","dr_l","lang_en"]},
  {n:"Japan", t:["reg_as","geo_isl","geo_mtn","cl_snow","soc_safe","soc_rich","inf_good","dr_l","gov_mon","misc_pop_hi","misc_bear"]},
  {n:"Jordan", t:["reg_as","geo_des","cl_hot","soc_safe","rel_isl","misc_hist"]},
  {n:"Kenya", t:["reg_af","geo_mtn","geo_cst","cl_hot","soc_dev","lang_en"]},
  {n:"South Korea", t:["reg_as","geo_mtn","geo_cst","cl_snow","soc_safe","soc_rich","inf_good","misc_pop_hi","misc_bear"]},
  {n:"Kuwait", t:["reg_as","geo_des","geo_cst","cl_hot","soc_rich","rel_isl"]},
  {n:"Laos", t:["reg_as","geo_mtn","geo_fst","geo_lnd","cl_trop","soc_dev","rel_bud","misc_bear"]},
  {n:"Latvia", t:["reg_eu","geo_fst","geo_cst","cl_snow","soc_safe","pol_eu","misc_bear"]},
  {n:"Lebanon", t:["reg_as","geo_mtn","geo_cst","cl_hot","soc_dev","food_spi"]},
  {n:"Libya", t:["reg_af","geo_des","geo_cst","cl_hot","soc_warn","rel_isl"]},
  {n:"Lithuania", t:["reg_eu","geo_fst","geo_cst","cl_snow","soc_safe","pol_eu"]},
  {n:"Luxembourg", t:["reg_eu","geo_fst","geo_lnd","cl_cold","soc_safe","soc_rich","pol_eu"]},
  {n:"Madagascar", t:["reg_af","geo_isl","geo_fst","cl_trop","soc_dev","lang_fr"]},
  {n:"Malaysia", t:["reg_as","geo_fst","geo_cst","cl_trop","soc_dev","rel_isl","dr_l","food_spi","misc_bear"]},
  {n:"Maldives", t:["reg_as","geo_isl","geo_bch","cl_trop","soc_dev","rel_isl"]},
  {n:"Mexico", t:["reg_na","geo_des","geo_bch","geo_mtn","cl_hot","soc_dev","lang_sp","food_spi","misc_pop_hi","misc_bear","v_110"]},
  {n:"Monaco", t:["reg_eu","geo_cst","cl_hot","soc_safe","soc_rich","gov_mon","lang_fr"]},
  {n:"Mongolia", t:["reg_as","geo_des","geo_mtn","geo_lnd","cl_snow","soc_dev","rel_bud","misc_bear"]},
  {n:"Morocco", t:["reg_af","geo_des","geo_mtn","geo_cst","cl_hot","soc_safe","rel_isl","lang_fr","food_spi"]},
  {n:"Nepal", t:["reg_as","geo_mtn","geo_lnd","cl_snow","soc_dev","rel_bud","misc_bear"]},
  {n:"Netherlands", t:["reg_eu","geo_cst","cl_rain","soc_safe","soc_rich","pol_eu","pol_nato","gov_mon"]},
  {n:"New Zealand", t:["reg_oc","geo_isl","geo_mtn","cl_rain","soc_safe","soc_rich","dr_l","lang_en","gov_mon"]},
  {n:"Nigeria", t:["reg_af","geo_fst","cl_trop","soc_dev","lang_en","misc_pop_hi"]},
  {n:"North Macedonia", t:["reg_eu","geo_mtn","geo_lnd","cl_cold","soc_dev","misc_bear"]},
  {n:"Norway", t:["reg_eu","geo_mtn","geo_cst","cl_snow","soc_safe","soc_rich","pol_nato","gov_mon","misc_bear"]},
  {n:"Oman", t:["reg_as","geo_des","geo_cst","cl_hot","soc_safe","rel_isl"]},
  {n:"Pakistan", t:["reg_as","geo_mtn","geo_des","cl_hot","soc_dev","rel_isl","lang_en","food_spi","misc_pop_hi","misc_bear"]},
  {n:"Panama", t:["reg_na","geo_fst","geo_bch","cl_trop","soc_dev","lang_sp","v_110"]},
  {n:"Peru", t:["reg_sa","geo_mtn","geo_des","geo_fst","cl_trop","soc_dev","lang_sp","misc_bear"]},
  {n:"Philippines", t:["reg_as","geo_isl","geo_bch","cl_trop","soc_dev","rel_chr","lang_en","misc_pop_hi"]},
  {n:"Poland", t:["reg_eu","geo_fst","geo_cst","cl_snow","soc_safe","soc_dev","pol_eu","pol_nato","misc_bear"]},
  {n:"Portugal", t:["reg_eu","geo_bch","geo_cst","cl_hot","soc_safe","pol_eu"]},
  {n:"Qatar", t:["reg_as","geo_des","cl_hot","soc_safe","soc_rich","rel_isl"]},
  {n:"Romania", t:["reg_eu","geo_mtn","geo_fst","cl_snow","soc_safe","soc_dev","pol_eu","pol_nato","misc_bear"]},
  {n:"Russia", t:["reg_eu","reg_as","geo_mtn","geo_fst","geo_cst","cl_snow","soc_rich","rel_chr","misc_pop_hi","misc_bear"]},
  {n:"Saudi Arabia", t:["reg_as","geo_des","cl_hot","soc_rich","rel_isl"]},
  {n:"Serbia", t:["reg_eu","geo_mtn","geo_lnd","cl_cold","soc_dev","misc_bear"]},
  {n:"Singapore", t:["reg_as","geo_isl","cl_trop","soc_safe","soc_rich","dr_l","lang_en","misc_pop_hi"]},
  {n:"Slovakia", t:["reg_eu","geo_mtn","geo_lnd","cl_snow","soc_safe","pol_eu","misc_bear"]},
  {n:"Slovenia", t:["reg_eu","geo_mtn","cl_cold","soc_safe","pol_eu","misc_bear"]},
  {n:"South Africa", t:["reg_af","geo_mtn","geo_des","geo_cst","cl_hot","soc_dev","dr_l","lang_en"]},
  {n:"Spain", t:["reg_eu","geo_bch","geo_mtn","cl_hot","soc_safe","pol_eu","lang_sp","misc_bear"]},
  {n:"Sri Lanka", t:["reg_as","geo_isl","geo_fst","cl_trop","soc_dev","rel_bud","dr_l","food_spi","misc_bear"]},
  {n:"Sweden", t:["reg_eu","geo_fst","geo_cst","cl_snow","soc_safe","soc_rich","pol_eu","gov_mon","misc_bear"]},
  {n:"Switzerland", t:["reg_eu","geo_mtn","geo_lnd","cl_snow","soc_safe","soc_rich","lang_fr","misc_bear"]},
  {n:"Syria", t:["reg_as","geo_des","cl_hot","soc_warn","rel_isl","misc_bear"]},
  {n:"Taiwan", t:["reg_as","geo_isl","geo_mtn","cl_trop","soc_safe","soc_rich","inf_good","food_spi","misc_bear"]},
  {n:"Thailand", t:["reg_as","geo_fst","geo_bch","cl_trop","soc_dev","rel_bud","food_spi","misc_bear"]},
  {n:"Tunisia", t:["reg_af","geo_des","geo_bch","cl_hot","soc_dev","rel_isl","lang_fr"]},
  {n:"Turkey", t:["reg_as","reg_eu","geo_mtn","geo_cst","cl_hot","soc_dev","pol_nato","rel_isl","food_spi","misc_pop_hi","misc_bear"]},
  {n:"Ukraine", t:["reg_eu","geo_fst","geo_cst","cl_snow","soc_warn","soc_dev","misc_pop_hi","misc_bear"]},
  {n:"UAE", t:["reg_as","geo_des","geo_cst","cl_hot","soc_safe","soc_rich","rel_isl"]},
  {n:"UK", t:["reg_eu","geo_isl","geo_cst","cl_rain","soc_safe","soc_rich","pol_nato","dr_l","gov_mon","lang_en","misc_pop_hi"]},
  {n:"USA", t:["reg_na","geo_mtn","geo_fst","geo_des","geo_cst","cl_snow","cl_hot","cl_trop","soc_safe","soc_rich","pol_nato","lang_en","misc_pop_hi","misc_bear","v_110"]},
  {n:"Uruguay", t:["reg_sa","geo_bch","geo_cst","cl_cold","soc_safe","soc_dev","lang_sp"]},
  {n:"Venezuela", t:["reg_sa","geo_mtn","geo_cst","cl_trop","soc_warn","soc_dev","lang_sp","v_110"]},
  {n:"Vietnam", t:["reg_as","geo_mtn","geo_cst","cl_trop","soc_safe","soc_dev","food_spi","misc_pop_hi","misc_bear"]}
];

// SUBDIVISIONS (States/Provinces) - Linking Parent Countries
const dbStates = [
  // USA
  {n:"California (USA)", t:["p_usa","reg_na","geo_cst","geo_mtn","geo_des","cl_hot","soc_rich","soc_lib","inf_good","lang_en"]},
  {n:"Texas (USA)", t:["p_usa","reg_na","geo_cst","geo_des","cl_hot","soc_rich","soc_con","lang_en","lang_sp"]},
  {n:"Florida (USA)", t:["p_usa","reg_na","geo_cst","geo_bch","cl_trop","soc_rich","misc_pop_hi","lang_en"]},
  {n:"Alaska (USA)", t:["p_usa","reg_na","geo_mtn","geo_fst","cl_snow","soc_safe","misc_bear","lang_en"]},
  {n:"New York (USA)", t:["p_usa","reg_na","geo_cst","geo_mtn","cl_cold","soc_rich","soc_lib","misc_pop_hi","lang_en"]},
  {n:"Hawaii (USA)", t:["p_usa","reg_na","geo_isl","geo_bch","cl_trop","soc_rich","lang_en"]},
  // CANADA
  {n:"Ontario (CAN)", t:["p_can","reg_na","geo_fst","cl_snow","soc_safe","misc_pop_hi","misc_bear","lang_en"]},
  {n:"Quebec (CAN)", t:["p_can","reg_na","geo_fst","cl_snow","soc_safe","lang_fr","misc_bear"]},
  {n:"British Columbia (CAN)", t:["p_can","reg_na","geo_mtn","geo_cst","cl_rain","soc_safe","misc_bear","lang_en"]},
  // UK
  {n:"Scotland (UK)", t:["p_uk","reg_eu","geo_mtn","geo_cst","cl_rain","soc_safe","dr_l","lang_en"]},
  {n:"England (UK)", t:["p_uk","reg_eu","geo_cst","cl_rain","soc_safe","soc_rich","dr_l","lang_en","misc_pop_hi"]},
  {n:"Wales (UK)", t:["p_uk","reg_eu","geo_mtn","geo_cst","cl_rain","soc_safe","dr_l","lang_en"]},
  // AUSTRALIA
  {n:"New South Wales (AUS)", t:["p_aus","reg_oc","geo_cst","geo_mtn","cl_hot","soc_rich","dr_l","lang_en"]},
  {n:"Queensland (AUS)", t:["p_aus","reg_oc","geo_cst","geo_bch","cl_trop","soc_safe","dr_l","lang_en"]},
  {n:"Victoria (AUS)", t:["p_aus","reg_oc","geo_cst","cl_cold","soc_rich","dr_l","lang_en"]}
];

// ==========================================
// 3. APP LOGIC
// ==========================================

const grid = document.getElementById('grid');
const filterContainer = document.getElementById('filter-container');
const searchInput = document.getElementById('search-input');
const countDisplay = document.getElementById('result-count');
const dbNameDisplay = document.getElementById('db-name');
const btnCountry = document.getElementById('mode-country');
const btnState = document.getElementById('mode-state');

let activeMode = 'country'; // 'country' or 'state'
let activeFilters = new Set();
let searchQuery = "";

// --- Render Sidebar Filters ---
function renderFilters() {
  filterContainer.innerHTML = `<div class="sidebar-header">Database Filters</div>`;
  
  categories.forEach(cat => {
    const accordion = document.createElement('div');
    accordion.className = 'accordion';
    
    // Header
    const header = document.createElement('div');
    header.className = 'accordion-header';
    header.innerHTML = `<span>${cat.name}</span><span class="icon">â–¼</span>`;
    header.onclick = () => accordion.classList.toggle('open');
    
    // Content
    const content = document.createElement('div');
    content.className = 'accordion-content';
    const tagContainer = document.createElement('div');
    tagContainer.className = 'tag-container';
    
    cat.tags.forEach(tag => {
      const btn = document.createElement('button');
      btn.className = 'filter-tag';
      btn.textContent = tag.l;
      btn.id = tag.id;
      
      if(activeFilters.has(tag.id)) btn.classList.add('active');
      
      btn.onclick = () => toggleFilter(tag.id, btn);
      tagContainer.appendChild(btn);
    });
    
    content.appendChild(tagContainer);
    accordion.appendChild(header);
    accordion.appendChild(content);
    filterContainer.appendChild(accordion);
  });
}

function toggleFilter(id, btn) {
  if (activeFilters.has(id)) {
    activeFilters.delete(id);
    btn.classList.remove('active');
  } else {
    activeFilters.add(id);
    btn.classList.add('active');
  }
  renderGrid();
}

// --- Render Main Grid ---
function renderGrid() {
  grid.innerHTML = "";
  const dataset = activeMode === 'country' ? dbCountries : dbStates;
  let count = 0;
  
  dataset.forEach(item => {
    // 1. Search Match
    const matchSearch = item.n.toLowerCase().includes(searchQuery.toLowerCase());
    
    // 2. Filter Match (AND logic)
    const matchFilters = [...activeFilters].every(tag => item.t.includes(tag));
    
    if (matchSearch && matchFilters) {
      count++;
      const card = document.createElement('div');
      card.className = 'card';
      
      // Determine color based on tags
      let badge = "";
      if(item.t.includes('geo_mtn')) badge = "MOUNTAIN";
      if(item.t.includes('geo_isl')) badge = "ISLAND";
      if(item.t.includes('p_usa')) badge = "US STATE";
      
      card.innerHTML = `
        <div class="card-badge">${badge || 'ENTITY'}</div>
        <div class="card-title">${item.n}</div>
        <div class="card-sub">${item.t.length} Attributes</div>
      `;
      grid.appendChild(card);
    }
  });
  
  countDisplay.textContent = `${count} Found`;
}

// --- Mode Switching ---
btnCountry.addEventListener('click', () => {
  activeMode = 'country';
  btnCountry.classList.add('active');
  btnState.classList.remove('active');
  dbNameDisplay.textContent = "Countries";
  activeFilters.clear();
  searchQuery = "";
  renderFilters(); // Re-render to clear active classes
  renderGrid();
});

btnState.addEventListener('click', () => {
  activeMode = 'state';
  btnState.classList.add('active');
  btnCountry.classList.remove('active');
  dbNameDisplay.textContent = "Subdivisions";
  activeFilters.clear();
  searchQuery = "";
  renderFilters();
  renderGrid();
});

// --- Search & Reset ---
searchInput.addEventListener('input', (e) => {
  searchQuery = e.target.value;
  renderGrid();
});

document.getElementById('reset').addEventListener('click', () => {
  activeFilters.clear();
  searchQuery = "";
  searchInput.value = "";
  renderFilters();
  renderGrid();
});

// Init
renderFilters();
renderGrid();

</script>
</body>
</html>
